2025-12-02 08:39:37 - __main__ - INFO - ================================================================================
2025-12-02 08:39:37 - __main__ - INFO - COMPARISON EXPERIMENT: Direct vs Transform-Enhanced Detection
2025-12-02 08:39:37 - __main__ - INFO - ================================================================================
2025-12-02 08:39:37 - __main__ - INFO - Task: polarity
2025-12-02 08:39:37 - __main__ - INFO - Model: data/polarity/outputs/final_model
2025-12-02 08:39:37 - __main__ - INFO - Train samples: 100
2025-12-02 08:39:37 - __main__ - INFO - Test samples: 50
2025-12-02 08:39:37 - __main__ - INFO - Transform: prefix_negation
2025-12-02 08:39:37 - __main__ - INFO - 
2025-12-02 08:39:37 - __main__ - INFO - Loading model...
2025-12-02 08:39:40 - __main__ - INFO - Loading data...
2025-12-02 08:39:40 - __main__ - INFO - Loaded 100 train samples, 0 poisoned
2025-12-02 08:39:40 - __main__ - INFO - Loaded 50 test samples
2025-12-02 08:39:40 - __main__ - ERROR - No poisoned samples found in training data!
2025-12-02 08:40:44 - __main__ - INFO - ================================================================================
2025-12-02 08:40:44 - __main__ - INFO - COMPARISON EXPERIMENT: Direct vs Transform-Enhanced Detection
2025-12-02 08:40:44 - __main__ - INFO - ================================================================================
2025-12-02 08:40:44 - __main__ - INFO - Task: polarity
2025-12-02 08:40:44 - __main__ - INFO - Model: data/polarity/outputs/final_model
2025-12-02 08:40:44 - __main__ - INFO - Train samples: 100
2025-12-02 08:40:44 - __main__ - INFO - Test samples: 50
2025-12-02 08:40:44 - __main__ - INFO - Transform: prefix_negation
2025-12-02 08:40:44 - __main__ - INFO - 
2025-12-02 08:40:44 - __main__ - INFO - Loading model...
2025-12-02 08:40:44 - __main__ - INFO - Loading data...
2025-12-02 08:40:44 - __main__ - INFO - Loaded 50 total poisoned indices, 8 in subset
2025-12-02 08:40:44 - __main__ - INFO - Loaded 100 train samples, 8 poisoned
2025-12-02 08:40:44 - __main__ - INFO - Loaded 50 test samples
2025-12-02 08:40:44 - __main__ - INFO - 
================================================================================
2025-12-02 08:40:44 - __main__ - INFO - STEP 1: Computing original influence scores
2025-12-02 08:40:44 - __main__ - INFO - ================================================================================
2025-12-02 08:40:44 - __main__ - INFO - Computing influence for: original
2025-12-02 08:40:44 - __main__ - INFO - Computing influence factors...
2025-12-02 08:40:44 - poison_detection.influence.analyzer - INFO - Using eigendecomposition dtype: torch.float64
2025-12-02 08:40:44 - poison_detection.influence.analyzer - INFO - Damping factor for scores: 1e-05
/mnt/nw/home/j.li/.local/lib/python3.10/site-packages/kronfluence/factor/covariance.py:200: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = GradScaler(init_scale=factor_args.amp_scale, enabled=enable_grad_scaler)
Fitting covariance matrices [0/50]   0%|           [time left: ?, time spent: 00:00]Fitting covariance matrices [1/50]   2%|▏          [time left: 00:53, time spent: 00:01]Fitting covariance matrices [2/50]   4%|▍          [time left: 00:25, time spent: 00:01]Fitting covariance matrices [3/50]   6%|▌          [time left: 00:16, time spent: 00:01]Fitting covariance matrices [4/50]   8%|▊          [time left: 00:11, time spent: 00:01]Fitting covariance matrices [5/50]  10%|█          [time left: 00:09, time spent: 00:01]Fitting covariance matrices [6/50]  12%|█▏         [time left: 00:08, time spent: 00:01]Fitting covariance matrices [7/50]  14%|█▍         [time left: 00:07, time spent: 00:01]Fitting covariance matrices [8/50]  16%|█▌         [time left: 00:06, time spent: 00:01]Fitting covariance matrices [9/50]  18%|█▊         [time left: 00:05, time spent: 00:02]Fitting covariance matrices [10/50]  20%|██         [time left: 00:05, time spent: 00:02]Fitting covariance matrices [11/50]  22%|██▏        [time left: 00:05, time spent: 00:02]Fitting covariance matrices [12/50]  24%|██▍        [time left: 00:04, time spent: 00:02]Fitting covariance matrices [13/50]  26%|██▌        [time left: 00:04, time spent: 00:02]Fitting covariance matrices [14/50]  28%|██▊        [time left: 00:04, time spent: 00:02]Fitting covariance matrices [15/50]  30%|███        [time left: 00:04, time spent: 00:02]Fitting covariance matrices [16/50]  32%|███▏       [time left: 00:04, time spent: 00:02]Fitting covariance matrices [17/50]  34%|███▍       [time left: 00:03, time spent: 00:03]Fitting covariance matrices [18/50]  36%|███▌       [time left: 00:03, time spent: 00:03]Fitting covariance matrices [19/50]  38%|███▊       [time left: 00:03, time spent: 00:03]Fitting covariance matrices [20/50]  40%|████       [time left: 00:03, time spent: 00:03]Fitting covariance matrices [21/50]  42%|████▏      [time left: 00:03, time spent: 00:03]Fitting covariance matrices [22/50]  44%|████▍      [time left: 00:03, time spent: 00:03]Fitting covariance matrices [23/50]  46%|████▌      [time left: 00:03, time spent: 00:03]Fitting covariance matrices [24/50]  48%|████▊      [time left: 00:03, time spent: 00:03]Fitting covariance matrices [25/50]  50%|█████      [time left: 00:02, time spent: 00:04]Fitting covariance matrices [26/50]  52%|█████▏     [time left: 00:02, time spent: 00:04]Fitting covariance matrices [27/50]  54%|█████▍     [time left: 00:02, time spent: 00:04]Fitting covariance matrices [28/50]  56%|█████▌     [time left: 00:02, time spent: 00:04]Fitting covariance matrices [29/50]  58%|█████▊     [time left: 00:02, time spent: 00:04]Fitting covariance matrices [30/50]  60%|██████     [time left: 00:02, time spent: 00:04]Fitting covariance matrices [31/50]  62%|██████▏    [time left: 00:02, time spent: 00:04]Fitting covariance matrices [32/50]  64%|██████▍    [time left: 00:02, time spent: 00:04]Fitting covariance matrices [33/50]  66%|██████▌    [time left: 00:02, time spent: 00:04]Fitting covariance matrices [34/50]  68%|██████▊    [time left: 00:01, time spent: 00:05]Fitting covariance matrices [35/50]  70%|███████    [time left: 00:01, time spent: 00:05]Fitting covariance matrices [36/50]  72%|███████▏   [time left: 00:01, time spent: 00:05]Fitting covariance matrices [37/50]  74%|███████▍   [time left: 00:01, time spent: 00:05]Fitting covariance matrices [38/50]  76%|███████▌   [time left: 00:01, time spent: 00:05]Fitting covariance matrices [39/50]  78%|███████▊   [time left: 00:01, time spent: 00:05]Fitting covariance matrices [40/50]  80%|████████   [time left: 00:01, time spent: 00:05]Fitting covariance matrices [41/50]  82%|████████▏  [time left: 00:01, time spent: 00:05]Fitting covariance matrices [42/50]  84%|████████▍  [time left: 00:00, time spent: 00:06]Fitting covariance matrices [43/50]  86%|████████▌  [time left: 00:00, time spent: 00:06]Fitting covariance matrices [44/50]  88%|████████▊  [time left: 00:00, time spent: 00:06]Fitting covariance matrices [45/50]  90%|█████████  [time left: 00:00, time spent: 00:06]Fitting covariance matrices [46/50]  92%|█████████▏ [time left: 00:00, time spent: 00:06]Fitting covariance matrices [47/50]  94%|█████████▍ [time left: 00:00, time spent: 00:06]Fitting covariance matrices [48/50]  96%|█████████▌ [time left: 00:00, time spent: 00:06]Fitting covariance matrices [49/50]  98%|█████████▊ [time left: 00:00, time spent: 00:06]Fitting covariance matrices [50/50] 100%|██████████ [time left: 00:00, time spent: 00:06]Fitting covariance matrices [50/50] 100%|██████████ [time left: 00:00, time spent: 00:06]
Performing Eigendecomposition [0/145]   0%|           [time left: ?, time spent: 00:00]Performing Eigendecomposition [1/145]   1%|           [time left: 00:14, time spent: 00:00]Performing Eigendecomposition [5/145]   3%|▎          [time left: 00:06, time spent: 00:00]Performing Eigendecomposition [7/145]   5%|▍          [time left: 00:06, time spent: 00:00]Performing Eigendecomposition [11/145]   8%|▊          [time left: 00:04, time spent: 00:00]Performing Eigendecomposition [14/145]  10%|▉          [time left: 00:05, time spent: 00:00]Performing Eigendecomposition [18/145]  12%|█▏         [time left: 00:04, time spent: 00:00]Performing Eigendecomposition [21/145]  14%|█▍         [time left: 00:05, time spent: 00:00]Performing Eigendecomposition [26/145]  18%|█▊         [time left: 00:04, time spent: 00:01]Performing Eigendecomposition [29/145]  20%|██         [time left: 00:04, time spent: 00:01]Performing Eigendecomposition [33/145]  23%|██▎        [time left: 00:04, time spent: 00:01]Performing Eigendecomposition [36/145]  25%|██▍        [time left: 00:04, time spent: 00:01]Performing Eigendecomposition [40/145]  28%|██▊        [time left: 00:04, time spent: 00:01]Performing Eigendecomposition [43/145]  30%|██▉        [time left: 00:04, time spent: 00:01]Performing Eigendecomposition [47/145]  32%|███▏       [time left: 00:03, time spent: 00:01]Performing Eigendecomposition [50/145]  34%|███▍       [time left: 00:03, time spent: 00:01]Performing Eigendecomposition [54/145]  37%|███▋       [time left: 00:03, time spent: 00:02]Performing Eigendecomposition [57/145]  39%|███▉       [time left: 00:03, time spent: 00:02]Performing Eigendecomposition [61/145]  42%|████▏      [time left: 00:02, time spent: 00:02]Performing Eigendecomposition [65/145]  45%|████▍      [time left: 00:02, time spent: 00:02]Performing Eigendecomposition [68/145]  47%|████▋      [time left: 00:02, time spent: 00:02]Performing Eigendecomposition [72/145]  50%|████▉      [time left: 00:02, time spent: 00:02]Performing Eigendecomposition [76/145]  52%|█████▏     [time left: 00:02, time spent: 00:02]Performing Eigendecomposition [80/145]  55%|█████▌     [time left: 00:02, time spent: 00:03]Performing Eigendecomposition [85/145]  59%|█████▊     [time left: 00:01, time spent: 00:03]Performing Eigendecomposition [89/145]  61%|██████▏    [time left: 00:02, time spent: 00:03]Performing Eigendecomposition [93/145]  64%|██████▍    [time left: 00:01, time spent: 00:03]Performing Eigendecomposition [97/145]  67%|██████▋    [time left: 00:01, time spent: 00:03]Performing Eigendecomposition [101/145]  70%|██████▉    [time left: 00:01, time spent: 00:03]Performing Eigendecomposition [106/145]  73%|███████▎   [time left: 00:01, time spent: 00:03]Performing Eigendecomposition [110/145]  76%|███████▌   [time left: 00:01, time spent: 00:04]Performing Eigendecomposition [113/145]  78%|███████▊   [time left: 00:01, time spent: 00:04]Performing Eigendecomposition [117/145]  81%|████████   [time left: 00:00, time spent: 00:04]Performing Eigendecomposition [121/145]  83%|████████▎  [time left: 00:00, time spent: 00:04]Performing Eigendecomposition [124/145]  86%|████████▌  [time left: 00:00, time spent: 00:04]Performing Eigendecomposition [128/145]  88%|████████▊  [time left: 00:00, time spent: 00:04]Performing Eigendecomposition [132/145]  91%|█████████  [time left: 00:00, time spent: 00:04]Performing Eigendecomposition [135/145]  93%|█████████▎ [time left: 00:00, time spent: 00:04]Performing Eigendecomposition [139/145]  96%|█████████▌ [time left: 00:00, time spent: 00:05]Performing Eigendecomposition [143/145]  99%|█████████▊ [time left: 00:00, time spent: 00:05]Performing Eigendecomposition [144/145]  99%|█████████▉ [time left: 00:00, time spent: 00:12]
Traceback (most recent call last):
  File "/mnt/nw/home/j.li/Poison-Detection/experiments/compare_direct_vs_transform_detection.py", line 585, in <module>
    run_experiment(args)
  File "/mnt/nw/home/j.li/Poison-Detection/experiments/compare_direct_vs_transform_detection.py", line 443, in run_experiment
    original_scores = compute_influence_scores(
  File "/mnt/nw/home/j.li/Poison-Detection/experiments/compare_direct_vs_transform_detection.py", line 155, in compute_influence_scores
    analyzer.compute_factors(train_loader, factors_name="ekfac", per_device_batch_size=2)
  File "/mnt/nw/home/j.li/Poison-Detection/poison_detection/influence/analyzer.py", line 95, in compute_factors
    self.analyzer.fit_all_factors(
  File "/mnt/nw/home/j.li/.local/lib/python3.10/site-packages/kronfluence/analyzer.py", line 182, in fit_all_factors
    self.perform_eigendecomposition(
  File "/mnt/nw/home/j.li/.local/lib/python3.10/site-packages/kronfluence/computer/factor_computer.py", line 452, in perform_eigendecomposition
    eigen_factors = perform_eigendecomposition(
  File "/mnt/nw/home/j.li/.local/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 120, in decorate_context
    return func(*args, **kwargs)
  File "/mnt/nw/home/j.li/.local/lib/python3.10/site-packages/kronfluence/factor/eigen.py", line 205, in perform_eigendecomposition
    eigenvalues, eigenvectors = torch.linalg.eigh(covariance_matrix)
torch._C._LinAlgError: cusolver error: CUSOLVER_STATUS_INVALID_VALUE, when calling `cusolverDnXsyevd_bufferSize( handle, params, jobz, uplo, n, CUDA_R_64F, reinterpret_cast<const void*>(A), lda, CUDA_R_64F, reinterpret_cast<const void*>(W), CUDA_R_64F, workspaceInBytesOnDevice, workspaceInBytesOnHost)`. This error may appear if the input matrix contains NaN. If you keep seeing this error, you may use `torch.backends.cuda.preferred_linalg_library()` to try linear algebra operators with other supported backends. See https://pytorch.org/docs/stable/backends.html#torch.backends.cuda.preferred_linalg_library
